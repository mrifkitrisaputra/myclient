{
    "sourceFile": "src/main/java/client/ui/render/GameRenderer.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1764830378852,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1764830378852,
            "name": "Commit-0",
            "content": "package com.client.ui.render;\r\n\r\nimport com.client.core.Arena;\r\nimport com.client.core.GameTimer;\r\nimport com.client.entities.Player;\r\nimport com.client.managers.BombManager; // IMPORT BARU\r\nimport com.client.managers.ExplosionManager;\r\nimport com.client.managers.ItemManager;\r\n\r\nimport javafx.scene.canvas.GraphicsContext;\r\nimport javafx.scene.image.Image;\r\nimport javafx.scene.paint.Color;\r\nimport javafx.scene.text.Font;\r\n\r\npublic class GameRenderer {\r\n\r\n    private final GameCanvas canvas;\r\n    private final Player player;\r\n    private final int[][] map;\r\n    private final BombManager bombs;\r\n    private final ExplosionManager explosions;\r\n    private final ItemManager itemManager; // FIELD BARU\r\n\r\n    private final CameraScaler scaler; // (Tambahkan field scaler yg sebelumnya lupa di-declare di snippet mu)\r\n    private final GameTimer timer;\r\n    private final Arena arena;\r\n\r\n    private final Image ground, breakable, unbreak;\r\n    private final int tile;\r\n\r\n    public GameRenderer(GameCanvas canvas, Player player, int[][] map,\r\n            BombManager bombs, ExplosionManager explosions,\r\n            ItemManager itemManager, // PARAMETER BARU\r\n            CameraScaler scaler, GameTimer timer, Arena arena) {\r\n        this.canvas = canvas;\r\n        this.player = player;\r\n        this.map = map;\r\n        this.bombs = bombs;\r\n        this.explosions = explosions;\r\n        this.itemManager = itemManager; // SIMPAN\r\n        this.scaler = scaler;\r\n        this.timer = timer;\r\n        this.arena = arena;\r\n        this.tile = canvas.getTileSize();\r\n\r\n        // Load images\r\n        ground = new Image(getClass().getResourceAsStream(\"/com/client/assets/tiles/ground.png\"), tile, tile, false, false);\r\n        breakable = new Image(getClass().getResourceAsStream(\"/com/client/assets/tiles/break.png\"), tile, tile, false, false);\r\n        unbreak = new Image(getClass().getResourceAsStream(\"/com/client/assets/tiles/unbreak.png\"), tile, tile, false, false);\r\n    }\r\n\r\n    public void render() {\r\n        GraphicsContext g = canvas.getGraphicsContext2D();\r\n        g.setFill(Color.web(\"#2c3e50\")); // Warna Dark Blue-Grey (Ala Discord/Modern UI)\r\n        g.fillRect(0, 0, canvas.getWidth(), canvas.getHeight());\r\n\r\n        double offsetX = canvas.getOffsetX();\r\n        double offsetY = canvas.getOffsetY();\r\n        double scale = canvas.getRenderScale();\r\n\r\n        g.save();\r\n        g.translate(offsetX, offsetY);\r\n        g.scale(scale, scale);\r\n\r\n        // 1. Map\r\n        renderMap(g);\r\n\r\n        // 2. Arena Highlight\r\n        renderArenaShrink(g);\r\n\r\n        // 3. Items (Render item di atas tanah, di bawah player)\r\n        itemManager.render(g);\r\n\r\n        // 4. Objects\r\n        bombs.render(g);\r\n        explosions.render(g);\r\n\r\n        boolean animSelesai = player.isDeathAnimFinished();\r\n\r\n        // Jika animasi BELUM selesai, tetap gambar (biarpun mati)\r\n        // Jika animasi SUDAH selesai, skip baris ini (Player Hilang)\r\n        if (!animSelesai) {\r\n             g.drawImage(player.update(1/60.0), player.x, player.y);\r\n        }\r\n        \r\n        g.restore();\r\n        renderUI(g);\r\n    }\r\n\r\n    private void renderMap(GraphicsContext g) {\r\n        for (int y = 0; y < map[0].length; y++) {\r\n            for (int x = 0; x < map.length; x++) {\r\n                Image img;\r\n                if (map[x][y] == 1) {\r\n                    img = unbreak; \r\n                }else if (map[x][y] == 2) {\r\n                    img = breakable; \r\n                }else {\r\n                    img = ground;\r\n                }\r\n\r\n                g.drawImage(img, x * tile, y * tile);\r\n            }\r\n        }\r\n    }\r\n\r\n    private void renderArenaShrink(GraphicsContext g) {\r\n        if (!arena.isShrinking()) {\r\n            return;\r\n        }\r\n\r\n        double alpha = 0.4 + 0.4 * Math.sin(arena.getShrinkAnimTimer() * 20);\r\n        g.setFill(Color.rgb(255, 0, 0, alpha));\r\n\r\n        int left = arena.getLeft();\r\n        int right = arena.getRight();\r\n        int top = arena.getTop();\r\n        int bottom = arena.getBottom();\r\n\r\n        String step = arena.getCurrentStepPattern();\r\n\r\n        if (\"LR\".equals(step)) {\r\n            g.fillRect(left * 32, 0, 32, map[0].length * 32);\r\n            g.fillRect(right * 32, 0, 32, map[0].length * 32);\r\n        } else if (\"TB\".equals(step)) {\r\n            g.fillRect(0, top * 32, map.length * 32, 32);\r\n            g.fillRect(0, bottom * 32, map.length * 32, 32);\r\n        }\r\n    }\r\n\r\n    private void renderUI(GraphicsContext g) {\r\n        g.save();\r\n        g.setFont(new Font(\"Consolas\", 48));\r\n        g.setFill(Color.WHITE);\r\n        g.setStroke(Color.BLACK);\r\n        g.setLineWidth(2);\r\n        String t = timer.toString();\r\n        g.strokeText(t, canvas.getWidth() - 150, 60);\r\n        g.fillText(t, canvas.getWidth() - 150, 60);\r\n        g.restore();\r\n    }\r\n}\r\n"
        }
    ]
}