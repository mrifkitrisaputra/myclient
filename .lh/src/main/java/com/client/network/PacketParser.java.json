{
    "sourceFile": "src/main/java/com/client/network/PacketParser.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1764833232081,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764833238522,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n package com.client.network;\r\n \r\n import com.client.ClientGameState;\r\n import com.client.entities.VisualBomb;\r\n-import com.myclient.entities.VisualExplosion;\r\n+import com.client.entities.VisualExplosion;\r\n import com.myclient.entities.VisualPlayer;\r\n import com.myclient.entities.VisualItem;\r\n \r\n import java.util.ArrayList;\r\n"
                },
                {
                    "date": 1764833247600,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,15 @@\n package com.client.network;\r\n \r\n import com.client.ClientGameState;\r\n+import com.client.entities.VisualBomb;\r\n+import com.client.entities.VisualExplosion;\r\n+import com.client.entities.VisualPlayer;\r\n+import com.client.entities.VisualItem;\r\n \r\n+import java.util.ArrayList;\r\n+import java.util.List;\r\n+\r\n public class PacketParser {\r\n \r\n     private final ClientGameState gameState;\r\n \r\n"
                }
            ],
            "date": 1764833232081,
            "name": "Commit-0",
            "content": "package com.client.network;\r\n\r\nimport com.myclient.ClientGameState;\r\nimport com.myclient.entities.VisualBomb;\r\nimport com.myclient.entities.VisualExplosion;\r\nimport com.myclient.entities.VisualPlayer;\r\nimport com.myclient.entities.VisualItem;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\npublic class PacketParser {\r\n\r\n    private final ClientGameState gameState;\r\n\r\n    public PacketParser(ClientGameState gameState) {\r\n        this.gameState = gameState;\r\n    }\r\n\r\n    public void parse(String packet) {\r\n        if (packet == null || packet.isEmpty()) return;\r\n\r\n        String[] parts = packet.split(\";\", 2);\r\n        String command = parts[0];\r\n        String data = parts.length > 1 ? parts[1] : \"\";\r\n\r\n        switch (command) {\r\n            // 1. Terima Peta Awal\r\n            // Format: MAP;Rows;Cols;0,1,2,0...\r\n            case \"MAP\" -> parseMap(data);\r\n\r\n            // 2. Update Posisi/State (Dikirim server 20-60 kali per detik)\r\n            // Format: STATE;Players...|Bombs...|Explosions...|Items...\r\n            case \"STATE\" -> parseState(data);\r\n\r\n            // 3. Game Info\r\n            case \"TIME\" -> gameState.setGameTime(Float.parseFloat(data));\r\n            case \"GAMEOVER\" -> gameState.setGameOver(true);\r\n        }\r\n    }\r\n\r\n    private void parseMap(String data) {\r\n        try {\r\n            String[] tokens = data.split(\";\");\r\n            int rows = Integer.parseInt(tokens[0]);\r\n            int cols = Integer.parseInt(tokens[1]);\r\n            String[] tiles = tokens[2].split(\",\");\r\n\r\n            int[][] map = new int[rows][cols];\r\n            for (int i = 0; i < tiles.length; i++) {\r\n                int x = i % rows; // Hati-hati tertukar x/y tergantung cara server kirim\r\n                int y = i / rows;\r\n                map[x][y] = Integer.parseInt(tiles[i]);\r\n            }\r\n            gameState.setMap(map);\r\n            System.out.println(\"Map Received: \" + rows + \"x\" + cols);\r\n        } catch (Exception e) {\r\n            System.err.println(\"Error parsing MAP: \" + e.getMessage());\r\n        }\r\n    }\r\n\r\n    private void parseState(String data) {\r\n        // Asumsi format data dipisah pipa (|)\r\n        // PL_DATA | BO_DATA | EX_DATA | IT_DATA\r\n        String[] sections = data.split(\"\\\\|\");\r\n        \r\n        if (sections.length >= 1) parsePlayers(sections[0]);\r\n        if (sections.length >= 2) parseBombs(sections[1]);\r\n        if (sections.length >= 3) parseExplosions(sections[2]);\r\n        if (sections.length >= 4) parseItems(sections[3]);\r\n    }\r\n\r\n    // Contoh format per player: id,x,y,state,dir#id,x,y,state,dir...\r\n    private void parsePlayers(String section) {\r\n        if (section.isEmpty() || section.equals(\"NP\")) { // NP = No Player\r\n            gameState.clearPlayers();\r\n            return;\r\n        }\r\n\r\n        // Logic sync list player (Sederhana: Hapus semua, buat baru)\r\n        // (Optimasi: Update existing player by ID, tapi ini cukup untuk awal)\r\n        gameState.clearPlayers();\r\n        \r\n        String[] playersData = section.split(\"#\");\r\n        for (String pStr : playersData) {\r\n            String[] pVal = pStr.split(\",\");\r\n            // Parsing: int id = Integer.parseInt(pVal[0]);\r\n            double x = Double.parseDouble(pVal[1]);\r\n            double y = Double.parseDouble(pVal[2]);\r\n            String stateStr = pVal[3]; // IDLE, WALK...\r\n            String dirStr = pVal[4];   // UP, DOWN...\r\n\r\n            // Disini kita butuh cara create VisualPlayer.\r\n            // Karena VisualPlayer butuh SpriteLoader, idealnya kita inject/static load.\r\n            // Untuk skema ini, kita anggap gameState bisa menghandle creation atau kita pass null loader sementara\r\n            // VisualPlayer vp = new VisualPlayer(null); <-- Ini butuh perbaikan di arsitektur nanti\r\n            // vp.setNetworkState(x, y, VisualPlayer.State.valueOf(stateStr), VisualPlayer.Direction.valueOf(dirStr));\r\n            // gameState.addPlayer(vp);\r\n        }\r\n    }\r\n\r\n    private void parseBombs(String section) {\r\n        // Implementasi mirip player\r\n    }\r\n\r\n    private void parseExplosions(String section) {\r\n        // Implementasi mirip player\r\n    }\r\n    \r\n    private void parseItems(String section) {\r\n        // Implementasi mirip player\r\n    }\r\n}"
        }
    ]
}