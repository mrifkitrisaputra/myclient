{
    "sourceFile": "src/main/java/com/client/App.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1764831883073,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764834138338,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,38 +1,108 @@\n-package com.client;\r\n+package com.myclient;\r\n \r\n-import java.io.IOException;\r\n-\r\n+import com.myclient.network.ClientNetworkManager;\r\n+import com.myclient.render.GameCanvas;\r\n+import com.myclient.ui.LoginScene;\r\n+import com.myclient.ui.SceneManager;\r\n import javafx.application.Application;\r\n-import javafx.fxml.FXMLLoader;\r\n-import javafx.scene.Parent;\r\n-import javafx.scene.Scene;\r\n+import javafx.application.Platform;\r\n+import javafx.scene.control.Alert;\r\n import javafx.stage.Stage;\r\n \r\n-/**\r\n- * JavaFX App\r\n- */\r\n+import java.io.IOException;\r\n+\r\n public class App extends Application {\r\n \r\n-    private static Scene scene;\r\n+    private static Stage primaryStage;\r\n+    \r\n+    // Global Access (Sederhana untuk sekala ini)\r\n+    public static ClientNetworkManager network;\r\n+    public static ClientGameState gameState;\r\n \r\n     @Override\r\n-    public void start(Stage stage) throws IOException {\r\n-        scene = new Scene(loadFXML(\"primary\"), 640, 480);\r\n-        stage.setScene(scene);\r\n+    public void start(Stage stage) {\r\n+        primaryStage = stage;\r\n+        SceneManager.setStage(stage);\r\n+\r\n+        // 1. Init Game State (Memori Data Game)\r\n+        gameState = new ClientGameState();\r\n+\r\n+        // 2. Tampilkan Login Scene dulu (Input IP)\r\n+        LoginScene login = new LoginScene(this::tryConnect);\r\n+        stage.setScene(login.getScene());\r\n+        stage.setTitle(\"Bomber Client - Connect\");\r\n         stage.show();\r\n     }\r\n \r\n-    static void setRoot(String fxml) throws IOException {\r\n-        scene.setRoot(loadFXML(fxml));\r\n+    /**\r\n+     * Logika Koneksi:\r\n+     * Dipanggil saat tombol \"Connect\" di LoginScene ditekan.\r\n+     */\r\n+    public void tryConnect(String ip) {\r\n+        // Default port 5000 (sesuaikan dengan server nanti)\r\n+        int port = 5000;\r\n+        \r\n+        // Buat Manager baru\r\n+        network = new ClientNetworkManager(ip, port, gameState);\r\n+        \r\n+        // Set callback jika putus koneksi\r\n+        network.setOnDisconnect(() -> Platform.runLater(() -> {\r\n+            showError(\"Connection Lost\", \"Disconnected from server.\");\r\n+            SceneManager.toLogin(this::tryConnect);\r\n+        }));\r\n+\r\n+        // Coba Konek (Jalankan di Thread terpisah agar UI tidak freeze)\r\n+        new Thread(() -> {\r\n+            try {\r\n+                network.connect(); // BLOCKING\r\n+                \r\n+                // Jika lolos baris ini, berarti sukses connect\r\n+                Platform.runLater(() -> {\r\n+                    System.out.println(\"Connected to \" + ip);\r\n+                    SceneManager.toLobby(); // Masuk Lobby\r\n+                });\r\n+\r\n+            } catch (IOException e) {\r\n+                Platform.runLater(() -> {\r\n+                    showError(\"Connection Failed\", \"Cannot reach server at \" + ip + \"\\n\" + e.getMessage());\r\n+                });\r\n+            }\r\n+        }).start();\r\n     }\r\n \r\n-    private static Parent loadFXML(String fxml) throws IOException {\r\n-        FXMLLoader fxmlLoader = new FXMLLoader(App.class.getResource(fxml + \".fxml\"));\r\n-        return fxmlLoader.load();\r\n+    /**\r\n+     * Memulai Game (Pindah ke Canvas)\r\n+     * Dipanggil oleh RoomScene saat semua player siap / server kirim START.\r\n+     */\r\n+    public static void startGame() {\r\n+        if (gameState == null || network == null) return;\r\n+        \r\n+        // Input Sender khusus untuk mengirim tombol ke server\r\n+        // InputHandler localInput = new InputHandler(); // Perlu di-hook ke Scene\r\n+        \r\n+        GameCanvas gameCanvas = new GameCanvas(gameState);\r\n+        // Setup input listener di sini (nanti dibahas di integrasi akhir)\r\n+        \r\n+        gameCanvas.start();\r\n+        SceneManager.toGame(gameCanvas);\r\n     }\r\n \r\n+    private void showError(String title, String content) {\r\n+        Alert alert = new Alert(Alert.AlertType.ERROR);\r\n+        alert.setTitle(title);\r\n+        alert.setHeaderText(null);\r\n+        alert.setContentText(content);\r\n+        alert.showAndWait();\r\n+    }\r\n+    \r\n+    @Override\r\n+    public void stop() throws Exception {\r\n+        if (network != null) network.close();\r\n+        super.stop();\r\n+        System.exit(0);\r\n+    }\r\n+\r\n     public static void main(String[] args) {\r\n         launch();\r\n     }\r\n-\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764834146501,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n package com.client;\r\n \r\n-import com.myclient.network.ClientNetworkManager;\r\n-import com.myclient.render.GameCanvas;\r\n+import com.client.network.ClientNetworkManager;\r\n+import com.client.render.GameCanvas;\r\n import com.myclient.ui.LoginScene;\r\n import com.myclient.ui.SceneManager;\r\n import javafx.application.Application;\r\n import javafx.application.Platform;\r\n"
                },
                {
                    "date": 1764834656530,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,8 +27,9 @@\n         // 1. Init Game State (Memori Data Game)\r\n         gameState = new ClientGameState();\r\n \r\n         // 2. Tampilkan Login Scene dulu (Input IP)\r\n+        \r\n         LoginScene login = new LoginScene(this::tryConnect);\r\n         stage.setScene(login.getScene());\r\n         stage.setTitle(\"Bomber Client - Connect\");\r\n         stage.show();\r\n"
                }
            ],
            "date": 1764831883073,
            "name": "Commit-0",
            "content": "package com.client;\r\n\r\nimport java.io.IOException;\r\n\r\nimport javafx.application.Application;\r\nimport javafx.fxml.FXMLLoader;\r\nimport javafx.scene.Parent;\r\nimport javafx.scene.Scene;\r\nimport javafx.stage.Stage;\r\n\r\n/**\r\n * JavaFX App\r\n */\r\npublic class App extends Application {\r\n\r\n    private static Scene scene;\r\n\r\n    @Override\r\n    public void start(Stage stage) throws IOException {\r\n        scene = new Scene(loadFXML(\"primary\"), 640, 480);\r\n        stage.setScene(scene);\r\n        stage.show();\r\n    }\r\n\r\n    static void setRoot(String fxml) throws IOException {\r\n        scene.setRoot(loadFXML(fxml));\r\n    }\r\n\r\n    private static Parent loadFXML(String fxml) throws IOException {\r\n        FXMLLoader fxmlLoader = new FXMLLoader(App.class.getResource(fxml + \".fxml\"));\r\n        return fxmlLoader.load();\r\n    }\r\n\r\n    public static void main(String[] args) {\r\n        launch();\r\n    }\r\n\r\n}"
        }
    ]
}