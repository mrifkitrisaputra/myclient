{
    "sourceFile": "src/main/java/com/client/server/SimpleTestServer.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1765155090578,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765155098419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,5 @@\n+package com.client.server;\r\n \r\n import java.io.BufferedReader;\r\n import java.io.IOException;\r\n import java.io.InputStreamReader;\r\n"
                },
                {
                    "date": 1765155383565,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,4 @@\n-package com.client.server;\r\n-\r\n import java.io.BufferedReader;\r\n import java.io.IOException;\r\n import java.io.InputStreamReader;\r\n import java.io.PrintWriter;\r\n@@ -37,9 +35,8 @@\n     public static void broadcastRoomList() {\r\n         if (lobbyClients.isEmpty()) return;\r\n         StringBuilder sb = new StringBuilder(\"ROOM_LIST;\");\r\n         for (Room r : rooms.values()) {\r\n-            // [UPDATE 1] Hanya tampilkan room jika game BELUM dimulai\r\n             if (!r.gameStarted) {\r\n                 String type = r.isPrivate ? \"(Private)\" : \"(Public)\";\r\n                 sb.append(r.name).append(\":\").append(type).append(\",\");\r\n             }\r\n@@ -133,35 +130,42 @@\n                         if (p.right) nextX += speed;\r\n                         if (p.up)    nextY -= speed;\r\n                         if (p.down)  nextY += speed;\r\n                         \r\n-                        if (!collisionHandler.checkCollision(nextX, p.y)) p.x = nextX;\r\n-                        if (!collisionHandler.checkCollision(p.x, nextY)) p.y = nextY;\r\n+                        // [UPDATE 1] Cek collision MAP dan PLAYER secara terpisah untuk X dan Y\r\n+                        // Cek sumbu X\r\n+                        boolean collideMapX = collisionHandler.checkCollision(nextX, p.y);\r\n+                        boolean collidePlayerX = collisionHandler.checkPlayerCollision(nextX, p.y, p, players);\r\n+                        \r\n+                        if (!collideMapX && !collidePlayerX) {\r\n+                            p.x = nextX;\r\n+                        }\r\n \r\n-                        // UPDATE ANIMASI DAN PRINT DEBUG JIKA BERUBAH\r\n+                        // Cek sumbu Y\r\n+                        boolean collideMapY = collisionHandler.checkCollision(p.x, nextY);\r\n+                        boolean collidePlayerY = collisionHandler.checkPlayerCollision(p.x, nextY, p, players);\r\n+\r\n+                        if (!collideMapY && !collidePlayerY) {\r\n+                            p.y = nextY;\r\n+                        }\r\n+\r\n                         p.updateAnimLogic();\r\n                     }\r\n \r\n                     // --- BROADCAST STATE ---\r\n                     StringBuilder sb = new StringBuilder(\"STATE;\");\r\n                     for (int i = 0; i < players.size(); i++) {\r\n                         PlayerState p = players.get(i);\r\n-                        \r\n-                        // Periksa apakah pesan yang disusun mengandung kata WALK\r\n-                        // Ini memastikan server tidak mengirim hardcoded IDLE\r\n                         sb.append(p.id).append(\",\")\r\n                           .append((int)p.x).append(\",\")\r\n                           .append((int)p.y).append(\",\")\r\n-                          .append(p.currentState).append(\",\")  // Dinamis\r\n-                          .append(p.currentDir);               // Dinamis\r\n+                          .append(p.currentState).append(\",\")  \r\n+                          .append(p.currentDir);               \r\n                         \r\n                         if (i < players.size() - 1) sb.append(\"#\");\r\n                     }\r\n                     sb.append(\"|||\"); \r\n                     \r\n-                    // [DEBUG OPTIONAL] Uncomment baris di bawah ini jika ingin melihat setiap paket (SPAMMY!)\r\n-                    // System.out.println(\"Sending: \" + sb.toString());\r\n-                    \r\n                     broadcast(sb.toString());\r\n \r\n                 } catch (Exception e) {\r\n                     System.err.println(\"Game Loop Error: \" + e.getMessage());\r\n@@ -179,8 +183,9 @@\n         }\r\n     }\r\n \r\n     // ===================== CLIENT HANDLER =======================\r\n+    // (Tidak ada perubahan di Class ClientHandler, disederhanakan untuk jawaban)\r\n     static class ClientHandler implements Runnable {\r\n         private Socket socket;\r\n         private PrintWriter out;\r\n         private BufferedReader in;\r\n@@ -209,12 +214,9 @@\n         }\r\n \r\n         public void send(String msg) { if (out != null) out.println(msg); }\r\n         \r\n-        public void sendRoomList() {\r\n-            // Logic sendRoomList sama dengan logic global\r\n-            SimpleTestServer.broadcastRoomList();\r\n-        }\r\n+        public void sendRoomList() { SimpleTestServer.broadcastRoomList(); }\r\n \r\n         private void handleMessage(String msg) {\r\n             try {\r\n                 String[] parts = msg.split(\";\");\r\n@@ -260,29 +262,21 @@\n                     if(currentRoom.host == this && currentRoom.clients.size() >= 1) { \r\n                          new Thread(() -> {\r\n                              System.out.println(\"[ROOM \" + currentRoom.name + \"] Starting game...\");\r\n                              currentRoom.initGameMap();\r\n-                             \r\n-                             // [UPDATE 2] Set gameStarted true dan update lobby\r\n                              currentRoom.gameStarted = true;\r\n-                             SimpleTestServer.broadcastRoomList(); // Broadcast agar room hilang dari lobby\r\n-                             \r\n+                             SimpleTestServer.broadcastRoomList(); \r\n                              currentRoom.broadcast(\"GAME_STARTED\");\r\n                              String mapData = currentRoom.getMapString();\r\n                              currentRoom.broadcast(\"MAP;13;13;\" + mapData);\r\n                          }).start();\r\n                     }\r\n                 }\r\n-                // --- INPUT HANDLER DENGAN DEBUG ---\r\n                 else if (command.equals(\"INPUT\") && currentRoom != null) {\r\n                       if (currentRoom.players.size() > playerId) {\r\n                           PlayerState p = currentRoom.players.get(playerId);\r\n                           String key = parts[1];\r\n-                          boolean pressed = Boolean.parseBoolean(parts[2]); // FIX Input\r\n-                          \r\n-                          // Debug Print Input Masuk\r\n-                          // System.out.println(\"[INPUT] Player \" + playerId + \" \" + key + \" = \" + pressed);\r\n-\r\n+                          boolean pressed = Boolean.parseBoolean(parts[2]); \r\n                           switch (key) {\r\n                             case \"UP\"    -> p.up = pressed;\r\n                             case \"DOWN\"  -> p.down = pressed;\r\n                             case \"LEFT\"  -> p.left = pressed;\r\n@@ -334,9 +328,34 @@\n             double bottom = top + hitboxSize;\r\n \r\n             return isSolid(left, top) || isSolid(right, top) || isSolid(left, bottom) || isSolid(right, bottom);\r\n         }\r\n+        \r\n+        // [UPDATE 2] Method baru untuk mengecek tabrakan antar player\r\n+        public boolean checkPlayerCollision(double newX, double newY, PlayerState self, List<PlayerState> allPlayers) {\r\n+            double selfL = newX + offset;\r\n+            double selfT = newY + offset;\r\n+            double selfR = selfL + hitboxSize;\r\n+            double selfB = selfT + hitboxSize;\r\n \r\n+            for (PlayerState other : allPlayers) {\r\n+                // Jangan cek tabrakan dengan diri sendiri\r\n+                if (other == self) continue; \r\n+\r\n+                double otherL = other.x + offset;\r\n+                double otherT = other.y + offset;\r\n+                double otherR = otherL + hitboxSize;\r\n+                double otherB = otherT + hitboxSize;\r\n+\r\n+                // Logic Intersection Rectangle (AABB)\r\n+                // Jika \"Kotak Saya\" tumpang tindih dengan \"Kotak Orang Lain\"\r\n+                if (selfL < otherR && selfR > otherL && selfT < otherB && selfB > otherT) {\r\n+                    return true; // Tabrakan!\r\n+                }\r\n+            }\r\n+            return false;\r\n+        }\r\n+\r\n         private boolean isSolid(double px, double py) {\r\n             int gridX = (int) (px / tileSize);\r\n             int gridY = (int) (py / tileSize);\r\n             if (gridX < 0 || gridY < 0 || gridX >= map.length || gridY >= map[0].length) return true;\r\n@@ -344,9 +363,9 @@\n             return (t == 1 || t == 2);\r\n         }\r\n     }\r\n \r\n-    // ===================== MAP GENERATOR =======================\r\n+    // ===================== MAP GENERATOR (SAMA SEPERTI SEBELUMNYA) =======================\r\n     static class MapGenerator {\r\n         public static int[][] generateMapArray(int w, int h) {\r\n             int[][] map = new int[w][h];\r\n             Random rand = new Random();\r\n@@ -374,9 +393,9 @@\n             return sb.toString();\r\n         }\r\n     }\r\n     \r\n-    // ===================== PLAYER STATE (WITH DEBUG) =======================\r\n+    // ===================== PLAYER STATE =======================\r\n     static class PlayerState {\r\n         int id; \r\n         double x, y;\r\n         boolean up, down, left, right;\r\n@@ -390,9 +409,9 @@\n         }\r\n         \r\n         public void updateAnimLogic() {\r\n             boolean isMoving = up || down || left || right;\r\n-            String oldState = currentState; // Simpan state lama\r\n+            String oldState = currentState; \r\n             \r\n             if (isMoving) {\r\n                 currentState = \"WALK\";\r\n                 \r\n@@ -403,12 +422,10 @@\n             } else {\r\n                 currentState = \"IDLE\";\r\n             }\r\n \r\n-            // --- DEBUG PRINT: HANYA MUNCUL JIKA STATUS BERUBAH ---\r\n             if (!currentState.equals(oldState)) {\r\n-                System.out.println(\"[DEBUG P\" + id + \"] Changed to: \" + currentState + \" (\" + currentDir + \")\");\r\n-                System.out.println(\"   --> Input: U=\" + up + \" D=\" + down + \" L=\" + left + \" R=\" + right);\r\n+                // Debug log\r\n             }\r\n         }\r\n     }\r\n }\n\\ No newline at end of file\n"
                }
            ],
            "date": 1765155090578,
            "name": "Commit-0",
            "content": "import java.io.BufferedReader;\r\nimport java.io.IOException;\r\nimport java.io.InputStreamReader;\r\nimport java.io.PrintWriter;\r\nimport java.net.ServerSocket;\r\nimport java.net.Socket;\r\nimport java.util.List;\r\nimport java.util.Map;\r\nimport java.util.Random;\r\nimport java.util.concurrent.ConcurrentHashMap;\r\nimport java.util.concurrent.CopyOnWriteArrayList;\r\n\r\npublic class SimpleTestServer {\r\n\r\n    private static final int PORT = 5000;\r\n    private static final Map<String, Room> rooms = new ConcurrentHashMap<>();\r\n    private static final List<ClientHandler> lobbyClients = new CopyOnWriteArrayList<>();\r\n\r\n    public static void main(String[] args) {\r\n        System.out.println(\"SERVER STARTED ON PORT \" + PORT + \" [DEBUG MODE ON]\");\r\n\r\n        try (ServerSocket serverSocket = new ServerSocket(PORT)) {\r\n            while (true) {\r\n                Socket clientSocket = serverSocket.accept();\r\n                ClientHandler client = new ClientHandler(clientSocket);\r\n                lobbyClients.add(client);\r\n                new Thread(client).start();\r\n                System.out.println(\"New Client connected: \" + clientSocket.getInetAddress());\r\n            }\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    public static void broadcastRoomList() {\r\n        if (lobbyClients.isEmpty()) return;\r\n        StringBuilder sb = new StringBuilder(\"ROOM_LIST;\");\r\n        for (Room r : rooms.values()) {\r\n            // [UPDATE 1] Hanya tampilkan room jika game BELUM dimulai\r\n            if (!r.gameStarted) {\r\n                String type = r.isPrivate ? \"(Private)\" : \"(Public)\";\r\n                sb.append(r.name).append(\":\").append(type).append(\",\");\r\n            }\r\n        }\r\n        String msg = sb.toString();\r\n        for (ClientHandler c : lobbyClients) c.send(msg);\r\n    }\r\n\r\n    // ===================== CLASS ROOM =======================\r\n    static class Room implements Runnable {\r\n        String name;\r\n        String password = \"\"; \r\n        boolean isPrivate = false;\r\n        boolean gameStarted = false;\r\n        boolean isRunning = true;\r\n\r\n        List<PlayerState> players = new CopyOnWriteArrayList<>();\r\n        List<ClientHandler> clients = new CopyOnWriteArrayList<>();\r\n        ClientHandler host;\r\n\r\n        private int[][] mapData; \r\n        private CollisionHandler collisionHandler;\r\n\r\n        public Room(String name, String password) {\r\n            this.name = name;\r\n            if (password != null && !password.isEmpty()) {\r\n                this.password = password;\r\n                this.isPrivate = true;\r\n            }\r\n        }\r\n\r\n        public synchronized int addPlayer(ClientHandler client) {\r\n            clients.add(client);\r\n            int id = clients.size() - 1;\r\n            client.playerId = id; \r\n            \r\n            double spawnX = (1 + id) * 32; \r\n            double spawnY = 32; \r\n            \r\n            players.add(new PlayerState(id, spawnX, spawnY));\r\n            \r\n            if (clients.size() == 1) host = client;\r\n            broadcastRoomInfo();\r\n            return id;\r\n        }\r\n\r\n        public synchronized void removePlayer(ClientHandler client, int playerId) {\r\n            clients.remove(client);\r\n            if (client == host && !clients.isEmpty()) {\r\n                host = clients.get(0);\r\n                System.out.println(\"[ROOM \" + name + \"] Host migrated to ID \" + host.playerId);\r\n            }\r\n            if (clients.isEmpty()) {\r\n                isRunning = false;\r\n                rooms.remove(name);\r\n                SimpleTestServer.broadcastRoomList(); \r\n                System.out.println(\"[ROOM \" + name + \"] Closed (Empty)\");\r\n            } else {\r\n                broadcastRoomInfo();\r\n            }\r\n        }\r\n        \r\n        public void broadcastRoomInfo() {\r\n            StringBuilder sb = new StringBuilder(\"ROOM_UPDATE;\");\r\n            int hostId = (host != null) ? host.playerId : -1;\r\n            sb.append(hostId).append(\";\");\r\n            for(ClientHandler c : clients) sb.append(c.playerId).append(\",\");\r\n            broadcast(sb.toString());\r\n        }\r\n\r\n        public void broadcast(String msg) {\r\n            for (ClientHandler c : clients) c.send(msg);\r\n        }\r\n\r\n        @Override\r\n        public void run() {\r\n            while (isRunning) {\r\n                try {\r\n                    Thread.sleep(16); \r\n                    \r\n                    if (!gameStarted || clients.isEmpty() || collisionHandler == null) continue;\r\n                    \r\n                    // --- PHYSICS UPDATE ---\r\n                    for (PlayerState p : players) {\r\n                        double speed = 3.0; \r\n                        \r\n                        double nextX = p.x;\r\n                        double nextY = p.y;\r\n                        \r\n                        if (p.left)  nextX -= speed;\r\n                        if (p.right) nextX += speed;\r\n                        if (p.up)    nextY -= speed;\r\n                        if (p.down)  nextY += speed;\r\n                        \r\n                        if (!collisionHandler.checkCollision(nextX, p.y)) p.x = nextX;\r\n                        if (!collisionHandler.checkCollision(p.x, nextY)) p.y = nextY;\r\n\r\n                        // UPDATE ANIMASI DAN PRINT DEBUG JIKA BERUBAH\r\n                        p.updateAnimLogic();\r\n                    }\r\n\r\n                    // --- BROADCAST STATE ---\r\n                    StringBuilder sb = new StringBuilder(\"STATE;\");\r\n                    for (int i = 0; i < players.size(); i++) {\r\n                        PlayerState p = players.get(i);\r\n                        \r\n                        // Periksa apakah pesan yang disusun mengandung kata WALK\r\n                        // Ini memastikan server tidak mengirim hardcoded IDLE\r\n                        sb.append(p.id).append(\",\")\r\n                          .append((int)p.x).append(\",\")\r\n                          .append((int)p.y).append(\",\")\r\n                          .append(p.currentState).append(\",\")  // Dinamis\r\n                          .append(p.currentDir);               // Dinamis\r\n                        \r\n                        if (i < players.size() - 1) sb.append(\"#\");\r\n                    }\r\n                    sb.append(\"|||\"); \r\n                    \r\n                    // [DEBUG OPTIONAL] Uncomment baris di bawah ini jika ingin melihat setiap paket (SPAMMY!)\r\n                    // System.out.println(\"Sending: \" + sb.toString());\r\n                    \r\n                    broadcast(sb.toString());\r\n\r\n                } catch (Exception e) {\r\n                    System.err.println(\"Game Loop Error: \" + e.getMessage());\r\n                }\r\n            }\r\n        }\r\n        \r\n        public void initGameMap() {\r\n            this.mapData = MapGenerator.generateMapArray(13, 13);\r\n            this.collisionHandler = new CollisionHandler(this.mapData, 32);\r\n        }\r\n        \r\n        public String getMapString() {\r\n            return MapGenerator.convertToString(this.mapData);\r\n        }\r\n    }\r\n\r\n    // ===================== CLIENT HANDLER =======================\r\n    static class ClientHandler implements Runnable {\r\n        private Socket socket;\r\n        private PrintWriter out;\r\n        private BufferedReader in;\r\n        private Room currentRoom;\r\n        public int playerId; \r\n\r\n        public ClientHandler(Socket socket) { this.socket = socket; }\r\n\r\n        @Override\r\n        public void run() {\r\n            try {\r\n                out = new PrintWriter(socket.getOutputStream(), true);\r\n                in = new BufferedReader(new InputStreamReader(socket.getInputStream()));\r\n                sendRoomList(); \r\n\r\n                String msg;\r\n                while ((msg = in.readLine()) != null) {\r\n                    handleMessage(msg);\r\n                }\r\n            } catch (IOException e) {\r\n            } finally {\r\n                lobbyClients.remove(this);\r\n                if (currentRoom != null) currentRoom.removePlayer(this, playerId);\r\n                System.out.println(\"Client disconnected.\");\r\n            }\r\n        }\r\n\r\n        public void send(String msg) { if (out != null) out.println(msg); }\r\n        \r\n        public void sendRoomList() {\r\n            // Logic sendRoomList sama dengan logic global\r\n            SimpleTestServer.broadcastRoomList();\r\n        }\r\n\r\n        private void handleMessage(String msg) {\r\n            try {\r\n                String[] parts = msg.split(\";\");\r\n                String command = parts[0];\r\n\r\n                if (command.equals(\"CREATE_ROOM\")) {\r\n                    String name = parts[1];\r\n                    boolean isPrivate = Boolean.parseBoolean(parts[2]);\r\n                    String pass = parts.length > 3 ? parts[3] : \"\";\r\n                    synchronized (rooms) {\r\n                        if (rooms.containsKey(name)) {\r\n                            send(\"ERROR;Room Name Taken\");\r\n                            return;\r\n                        }\r\n                        Room newRoom = new Room(name, isPrivate ? pass : null);\r\n                        rooms.put(name, newRoom);\r\n                        new Thread(newRoom).start();\r\n                        SimpleTestServer.broadcastRoomList();\r\n                        joinRoom(newRoom);\r\n                    }\r\n                } \r\n                else if (command.equals(\"JOIN_ROOM\")) {\r\n                    String name = parts[1];\r\n                    String passInput = parts.length > 2 ? parts[2] : \"\";\r\n                    Room room = rooms.get(name);\r\n                    if (room != null) {\r\n                        if (room.isPrivate && !room.password.equals(passInput)) {\r\n                            send(\"ERROR;Wrong Password\");\r\n                        } else {\r\n                            joinRoom(room);\r\n                        }\r\n                    }\r\n                } \r\n                else if (command.equals(\"LEAVE_ROOM\")) {\r\n                    if (currentRoom != null) {\r\n                        currentRoom.removePlayer(this, playerId);\r\n                        currentRoom = null;\r\n                        lobbyClients.add(this);\r\n                        sendRoomList();\r\n                    }\r\n                }\r\n                else if (command.equals(\"START_GAME\") && currentRoom != null) {\r\n                    if(currentRoom.host == this && currentRoom.clients.size() >= 1) { \r\n                         new Thread(() -> {\r\n                             System.out.println(\"[ROOM \" + currentRoom.name + \"] Starting game...\");\r\n                             currentRoom.initGameMap();\r\n                             \r\n                             // [UPDATE 2] Set gameStarted true dan update lobby\r\n                             currentRoom.gameStarted = true;\r\n                             SimpleTestServer.broadcastRoomList(); // Broadcast agar room hilang dari lobby\r\n                             \r\n                             currentRoom.broadcast(\"GAME_STARTED\");\r\n                             String mapData = currentRoom.getMapString();\r\n                             currentRoom.broadcast(\"MAP;13;13;\" + mapData);\r\n                         }).start();\r\n                    }\r\n                }\r\n                // --- INPUT HANDLER DENGAN DEBUG ---\r\n                else if (command.equals(\"INPUT\") && currentRoom != null) {\r\n                      if (currentRoom.players.size() > playerId) {\r\n                          PlayerState p = currentRoom.players.get(playerId);\r\n                          String key = parts[1];\r\n                          boolean pressed = Boolean.parseBoolean(parts[2]); // FIX Input\r\n                          \r\n                          // Debug Print Input Masuk\r\n                          // System.out.println(\"[INPUT] Player \" + playerId + \" \" + key + \" = \" + pressed);\r\n\r\n                          switch (key) {\r\n                            case \"UP\"    -> p.up = pressed;\r\n                            case \"DOWN\"  -> p.down = pressed;\r\n                            case \"LEFT\"  -> p.left = pressed;\r\n                            case \"RIGHT\" -> p.right = pressed;\r\n                        }\r\n                      }\r\n                }\r\n                else if (command.equals(\"ACTION\") && parts.length > 1 && parts[1].equals(\"PLACE_BOMB\") && currentRoom != null) {\r\n                    if (playerId < currentRoom.players.size()) {\r\n                        PlayerState p = currentRoom.players.get(playerId);\r\n                        p.place = true;\r\n                        new Thread(() -> {\r\n                            try { Thread.sleep(200); } catch (Exception ignored) {}\r\n                            p.place = false;\r\n                        }).start();\r\n                    }\r\n                }\r\n            } catch (Exception e) {\r\n                System.err.println(\"Error processing message: \" + msg);\r\n            }\r\n        }\r\n\r\n        private void joinRoom(Room room) {\r\n            lobbyClients.remove(this); \r\n            if (currentRoom != null) currentRoom.removePlayer(this, playerId);\r\n            currentRoom = room;\r\n            int newId = room.addPlayer(this);\r\n            send(\"YOUR_ID;\" + newId);\r\n        }\r\n    }\r\n\r\n    // ===================== COLLISION HANDLER =======================\r\n    static class CollisionHandler {\r\n        private final int[][] map;\r\n        private final int tileSize;\r\n        public final double hitboxSize = 20.5;\r\n        public final double offset;\r\n\r\n        public CollisionHandler(int[][] map, int tileSize) {\r\n            this.map = map;\r\n            this.tileSize = tileSize;\r\n            this.offset = (tileSize - hitboxSize) / 2.0; \r\n        }\r\n\r\n        public boolean checkCollision(double x, double y) {\r\n            double left = x + offset;\r\n            double top = y + offset;\r\n            double right = left + hitboxSize;\r\n            double bottom = top + hitboxSize;\r\n\r\n            return isSolid(left, top) || isSolid(right, top) || isSolid(left, bottom) || isSolid(right, bottom);\r\n        }\r\n\r\n        private boolean isSolid(double px, double py) {\r\n            int gridX = (int) (px / tileSize);\r\n            int gridY = (int) (py / tileSize);\r\n            if (gridX < 0 || gridY < 0 || gridX >= map.length || gridY >= map[0].length) return true;\r\n            int t = map[gridX][gridY];\r\n            return (t == 1 || t == 2);\r\n        }\r\n    }\r\n\r\n    // ===================== MAP GENERATOR =======================\r\n    static class MapGenerator {\r\n        public static int[][] generateMapArray(int w, int h) {\r\n            int[][] map = new int[w][h];\r\n            Random rand = new Random();\r\n            for (int y = 0; y < h; y++) {\r\n                for (int x = 0; x < w; x++) {\r\n                    if (x == 0 || y == 0 || x == w - 1 || y == h - 1) { map[x][y] = 1; continue; }\r\n                    if (x % 2 == 0 && y % 2 == 0) { map[x][y] = 1; continue; }\r\n                    if (rand.nextDouble() < 0.70) { map[x][y] = 2; } else { map[x][y] = 0; }\r\n                }\r\n            }\r\n            if (w > 2 && h > 3) { \r\n                map[1][1] = 0; map[1][2] = 0; map[1][3] = 0; \r\n                map[2][1] = 0; map[3][1] = 0;\r\n            }\r\n            return map;\r\n        }\r\n        \r\n        public static String convertToString(int[][] map) {\r\n            StringBuilder sb = new StringBuilder();\r\n            for (int y = 0; y < map[0].length; y++) {\r\n                for (int x = 0; x < map.length; x++) {\r\n                    sb.append(map[x][y]).append(\",\");\r\n                }\r\n            }\r\n            return sb.toString();\r\n        }\r\n    }\r\n    \r\n    // ===================== PLAYER STATE (WITH DEBUG) =======================\r\n    static class PlayerState {\r\n        int id; \r\n        double x, y;\r\n        boolean up, down, left, right;\r\n        boolean place; \r\n        \r\n        String currentState = \"IDLE\";\r\n        String currentDir = \"DOWN\";\r\n\r\n        public PlayerState(int id, double x, double y) { \r\n            this.id=id; this.x=x; this.y=y; \r\n        }\r\n        \r\n        public void updateAnimLogic() {\r\n            boolean isMoving = up || down || left || right;\r\n            String oldState = currentState; // Simpan state lama\r\n            \r\n            if (isMoving) {\r\n                currentState = \"WALK\";\r\n                \r\n                if (down)      currentDir = \"DOWN\";\r\n                else if (up)   currentDir = \"UP\";\r\n                else if (left) currentDir = \"LEFT\";\r\n                else if (right)currentDir = \"RIGHT\";\r\n            } else {\r\n                currentState = \"IDLE\";\r\n            }\r\n\r\n            // --- DEBUG PRINT: HANYA MUNCUL JIKA STATUS BERUBAH ---\r\n            if (!currentState.equals(oldState)) {\r\n                System.out.println(\"[DEBUG P\" + id + \"] Changed to: \" + currentState + \" (\" + currentDir + \")\");\r\n                System.out.println(\"   --> Input: U=\" + up + \" D=\" + down + \" L=\" + left + \" R=\" + right);\r\n            }\r\n        }\r\n    }\r\n}"
        }
    ]
}